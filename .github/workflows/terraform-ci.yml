name: Terraform Format, Init, Validate & Plan

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  terraform:
    name: Terraform CI Pipeline
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      # NEW STEP â€” build lambda.zip
      - name: Build Lambda ZIP
        run: |
          cd lambda
          zip -r lambda.zip index.js

      - name: Set up Terraform
        uses: hashicorp/setup-terraform@v2

      - name: Terraform fmt check
        run: terraform fmt -check

      - name: Terraform init
        run: terraform init
        working-directory: infra

      - name: Terraform validate
        run: terraform validate
        working-directory: infra

      #- name: Terraform plan
      #  run: terraform plan
      #  working-directory: infra
